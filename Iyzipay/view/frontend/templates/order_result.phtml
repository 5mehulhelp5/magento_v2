<?php
/** @var \Iyzico\Iyzipay\Block\Order\Result $block */
/** @var \Magento\Framework\Escaper $escaper */
/** @var \Magento\Sales\Model\Order $order */
$order = $block->getData('order');
$errorMessage = $block->getData('error_message');
?>
<div class="breadcrumbs">
    <ul class="items">
        <li class="item home">
            <a href="<?= $escaper->escapeUrl($block->getUrl('')) ?>"
                title="<?= $escaper->escapeHtmlAttr(__('Go to Home Page')) ?>">
                <?= $escaper->escapeHtml(__('Home')) ?>
            </a>
        </li>
        <li class="item cms_page">
            <strong><?= $escaper->escapeHtml(__('Order Information')) ?></strong>
        </li>
    </ul>
</div>
<main id="maincontent" class="page-main">
    <?php if ($errorMessage): ?>
        <div class="message error">
            <?= $escaper->escapeHtml($errorMessage) ?>
        </div>
    <?php elseif ($order): ?>
        <div class="page-title-wrapper">
            <h1 class="page-title">
                <span class="base" data-ui-id="page-title-wrapper">
                    <?= $escaper->escapeHtml(__('Order #%1', $order->getIncrementId())) ?>
                </span>
            </h1>
            <span class="order-status"><?= $escaper->escapeHtml($order->getStatusLabel()) ?></span>
            <div class="order-date">
                <span class="label"><?= $escaper->escapeHtml(__('Order Date:')) ?></span>
                <span><?= $block->formatDate($order->getCreatedAt(), \IntlDateFormatter::MEDIUM) ?></span>
            </div>
            <?php if ($order->getState() === \Magento\Sales\Model\Order::STATE_PENDING_PAYMENT): ?>
                <div class="actions-toolbar order-actions-toolbar">
                    <div class="actions">
                        <a href="<?= $escaper->escapeUrl($block->getUrl('iyzipay/payment/retry', ['order' => $order->getId()])) ?>"
                            class="action order">
                            <span><?= $escaper->escapeHtml(__('Try To Pay Again')) ?></span>
                        </a>
                    </div>
                </div>
            <?php endif; ?>
        </div>
        <div class="columns">
            <div class="column main">
                <div class="order-details-items ordered">
                    <div class="order-title">
                        <strong><?= $escaper->escapeHtml(__('Items Ordered')) ?></strong>
                    </div>
                    <div class="table-wrapper order-items">
                        <table class="data table table-order-items" id="my-orders-table"
                            summary="<?= $escaper->escapeHtml(__('Items Ordered')) ?>">
                            <thead>
                                <tr>
                                    <th class="col name"><?= $escaper->escapeHtml(__('Product Name')) ?></th>
                                    <th class="col sku"><?= $escaper->escapeHtml(__('SKU')) ?></th>
                                    <th class="col price"><?= $escaper->escapeHtml(__('Price')) ?></th>
                                    <th class="col qty"><?= $escaper->escapeHtml(__('Qty')) ?></th>
                                    <th class="col subtotal"><?= $escaper->escapeHtml(__('Subtotal')) ?></th>
                                </tr>
                            </thead>
                            <tbody>
                                <?php foreach ($order->getAllVisibleItems() as $item): ?>
                                    <tr id="order-item-row-<?= $escaper->escapeHtmlAttr($item->getId()) ?>">
                                        <td class="col name" data-th="<?= $escaper->escapeHtml(__('Product Name')) ?>">
                                            <strong
                                                class="product name product-item-name"><?= $escaper->escapeHtml($item->getName()) ?></strong>
                                        </td>
                                        <td class="col sku" data-th="<?= $escaper->escapeHtml(__('SKU')) ?>">
                                            <?= $escaper->escapeHtml($item->getSku()) ?>
                                        </td>
                                        <td class="col price" data-th="<?= $escaper->escapeHtml(__('Price')) ?>">
                                            <?= $block->formatPrice($item->getPrice()) ?>
                                        </td>
                                        <td class="col qty" data-th="<?= $escaper->escapeHtml(__('Qty')) ?>">
                                            <ul class="items-qty">
                                                <li class="item">
                                                    <span class="title"><?= $escaper->escapeHtml(__('Ordered')) ?></span>
                                                    <span
                                                        class="content"><?= $escaper->escapeHtml($item->getQtyOrdered()) ?></span>
                                                </li>
                                            </ul>
                                        </td>
                                        <td class="col subtotal" data-th="<?= $escaper->escapeHtml(__('Subtotal')) ?>">
                                            <?= $block->formatPrice($item->getRowTotal()) ?>
                                        </td>
                                    </tr>
                                <?php endforeach; ?>
                            </tbody>
                            <tfoot>
                                <tr class="subtotal">
                                    <th colspan="4" class="mark" scope="row"><?= $escaper->escapeHtml(__('Subtotal')) ?>
                                    </th>
                                    <td class="amount" data-th="<?= $escaper->escapeHtml(__('Subtotal')) ?>">
                                        <span class="price"><?= $block->formatPrice($order->getSubtotal()) ?></span>
                                    </td>
                                </tr>
                                <?php if ($order->getShippingAmount() > 0): ?>
                                    <tr class="shipping">
                                        <th colspan="4" class="mark" scope="row">
                                            <?= $escaper->escapeHtml(__('Shipping & Handling')) ?>
                                        </th>
                                        <td class="amount" data-th="<?= $escaper->escapeHtml(__('Shipping & Handling')) ?>">
                                            <span class="price"><?= $block->formatPrice($order->getShippingAmount()) ?></span>
                                        </td>
                                    </tr>
                                <?php endif; ?>
                                <tr class="grand_total">
                                    <th colspan="4" class="mark" scope="row">
                                        <strong><?= $escaper->escapeHtml(__('Grand Total')) ?></strong>
                                    </th>
                                    <td class="amount" data-th="<?= $escaper->escapeHtml(__('Grand Total')) ?>">
                                        <strong><span
                                                class="price"><?= $block->formatPrice($order->getGrandTotal()) ?></span></strong>
                                    </td>
                                </tr>
                            </tfoot>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    <?php endif; ?>
</main>